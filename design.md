# 星図表示アプリ 要件定義書

## 1. 概要

本アプリは、現在位置（GPSなどで取得）や特定の日付に基づいて、夜空の星図を表示するPC向けアプリケーションである。星図データは外部のデータソースから取得し、ユーザーがインタラクティブに操作できるUIを提供する。

---

## 2. 機能要件

### 2.1 基本機能
1. **現在位置の星図表示**  
   - GPSや手動入力で取得した緯度・経度・高度を基に、その位置から見える星空をリアルタイムで表示。

2. **過去・未来の星図表示**  
   - カレンダー機能で特定の日時を選択し、その時点での星図を表示する。

3. **星図のデータ取得**  
   - 外部APIを利用して、星の位置・明るさ・星座のラインなどのデータを取得。

4. **星座情報の表示**  
   - 星座名、星の名前、神話・由来などの情報を提供。

5. **インタラクティブなUI**  
   - ピンチ操作でズームイン・アウト  
   - スワイプで視点の変更  
   - 検索機能（星や星座の名前から検索）  

6. **表示モード**  
   - 夜間モード（黒背景＋赤色UI）  
   - 通常モード（青空背景）  

7. **現実との比較機能**  
   - **方位磁石との連携:** 端末のコンパスを利用して、画面の方向と実際の空を一致させる。  
   - **カメラオーバーレイ:** カメラを使わずに、現在の空をアプリの星図に重ねて表示。  

---

## 3. 非機能要件

### 3.1 パフォーマンス
- スムーズな描画（WebGL, OpenGL, DirectX などを活用）
- 高速なデータ取得・キャッシュ機構の導入

### 3.2 互換性
- **Linux環境での動作を保証**

### 3.3 拡張性
- 惑星・流星群・彗星の表示  
- AR対応（カメラを通して星空とオーバーレイ）  

### 3.4 セキュリティ
- 位置情報の取得に対するユーザー許可  
- APIキーの管理  

---

## 4. データ要件

### 4.1 星図データのソース
- NASA, ESA, Skyfield, HYG Database, StarMap API など

### 4.2 データの種類
- **星の基本情報**: 名前、位置（RA, Dec, Alt, Az）、明るさ（等級）  
- **星座ラインデータ**: 星座を構成する線の座標  
- **惑星の位置情報**  

### 4.3 データ取得の更新頻度
- 定期的にデータを取得（例: 24時間ごとにキャッシュ更新）  
- オフライン時はキャッシュデータを利用  

---

## 5. UI/UXの詳細

1. **視野角の調整**
   - 魚眼レンズ風に広範囲を表示できるオプション

2. **時間の高速スクロール**
   - 指定した速度で時間を早送りし、星の動きをシミュレーション

3. **お気に入り機能**
   - よく見る星や星座を登録

---

## 6. カメラ制御の設計

### 6.1 方位円中心視点
- カメラ位置：原点（0, 0, 0）に固定
- 視野角（FOV）：75度
- 初期視点：北向き（z軸正方向）
- 描画範囲：near = 0.1, far = 200

### 6.2 カメラ制御方式
- 位置：方位円中心に固定
- 回転：自由に回転可能
- パン：無効化（位置固定のため）
- ズーム：視野角の調整として実装

### 6.3 天体フォーカス機能
- フォーカス方式：カメラの回転のみ
- アニメーション：
  - lerpによるスムーズな補間
  - 回転の遷移時間：約0.5秒
  - 補間速度：0.05（1フレームあたり5%）
- フォーカス解除：
  - ESCキー
  - 背景クリック
  - 検索バーでの選択解除

## 7. 技術選定

### 7.1 開発技術
- **フロントエンド:** Electron + WebGL（React/Three.js）
- **バックエンド:** Python（FastAPI）、SQLite
- **UI/UXライブラリ:** Material-UI
- **状態管理:** Redux Toolkit

### 7.2 データ処理の分離
- 星図計算・データ取得ロジックはバックエンドAPI化する

---

## 7. CI/CD パイプライン

### 7.1 GitHub Actions
- プッシュ時の自動テスト実行
  - フロントエンド：Jest + React Testing Library
  - バックエンド：pytest
- コードスタイルチェック
  - JavaScript/React：ESLint
  - Python：Flake8
- セキュリティスキャン
  - 依存パッケージの脆弱性チェック
  - Snykによるセキュリティ分析

### 7.2 コード品質管理
- Codecovによるテストカバレッジの可視化
- プルリクエスト時の自動レビュー
- 品質基準
  - テストカバレッジ80%以上
  - ESLint/Flake8の警告ゼロ
  - 複雑度スコアの制限（10以下）

## 8. 制約
- 星図描画はリアルタイム処理が可能な技術を用いる（例: WebGL）
- 外部APIの選定次第でデータ取得の精度が変わる
- テストカバレッジは80%以上を維持する
- mainブランチへの直接プッシュは禁止

---

## 9. 追加検討事項

1. **追加のデータソース**
   - **Heavens Above API**（ISSや人工衛星の位置表示）  
   - **JPL Horizons API**（小惑星・彗星のデータ取得）  
   - **SDSS（Sloan Digital Sky Survey）**（天体画像データ）  

2. **オフライン対応**
   - 一定範囲の星図データをローカルキャッシュ可能にする  

---
